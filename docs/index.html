<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>keyed: Explicit Key Assumptions for Flat-File Workflows • keyed</title>
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="keyed: Explicit Key Assumptions for Flat-File Workflows">
<meta name="description" content="Define and maintain key assumptions in data workflows. Keys survive dplyr transformations, with optional row IDs and drift detection.
">
<meta property="og:description" content="Define and maintain key assumptions in data workflows. Keys survive dplyr transformations, with optional row IDs and drift detection.
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">keyed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/getting-started.html">Getting Started</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/keyed" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="keyed">keyed<a class="anchor" aria-label="anchor" href="#keyed"></a>
</h1></div>
<p><a href="https://github.com/gcol33/keyed/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/gcol33/keyed/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a> <a href="https://opensource.org/licenses/MIT" class="external-link"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a></p>
<p><strong>Explicit Key Assumptions for Flat-File Data Workflows</strong></p>
<p>The <code>keyed</code> package helps you define and maintain key assumptions in data workflows where you work with CSVs, Excel files, and other flat files without database schemas. Define keys once, validate at creation, and get warnings when assumptions break.</p>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gcol33/keyed" class="external-link">keyed</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a key - the only required action</span></span>
<span><span class="va">users</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"users.csv"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/key.html">key</a></span><span class="op">(</span><span class="va">user_id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Keys survive transformations</span></span>
<span><span class="va">active_users</span> <span class="op">&lt;-</span> <span class="va">users</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">status</span> <span class="op">==</span> <span class="st">"active"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">".*@"</span>, <span class="st">""</span>, <span class="va">email</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/has_key.html">has_key</a></span><span class="op">(</span><span class="va">active_users</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># Check assumptions</span></span>
<span><span class="fu"><a href="reference/assume_unique.html">assume_unique</a></span><span class="op">(</span><span class="va">users</span>, <span class="va">user_id</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/assume_no_na.html">assume_no_na</a></span><span class="op">(</span><span class="va">users</span>, <span class="va">email</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Diagnose joins before running them</span></span>
<span><span class="fu"><a href="reference/diagnose_join.html">diagnose_join</a></span><span class="op">(</span><span class="va">users</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"user_id"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Join Diagnosis ──</span></span>
<span><span class="co">#&gt; Cardinality: one-to-many</span></span>
<span><span class="co">#&gt; x: 1000 rows, unique</span></span>
<span><span class="co">#&gt; y: 5432 rows, 4432 duplicates</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="statement-of-need">Statement of Need<a class="anchor" aria-label="anchor" href="#statement-of-need"></a>
</h2>
<p>Working with flat files (CSVs, Excel exports) often means implicit assumptions about data structure: “this column should be unique”, “these columns form a composite key”, “there shouldn’t be NAs here”. These assumptions live in your head or scattered comments, breaking silently when data changes.</p>
<p><code>keyed</code> addresses this by providing:</p>
<ul>
<li>
<strong>Explicit key definitions</strong> that travel with the data through transformations</li>
<li>
<strong>Graceful degradation</strong> - warnings when keys break, not hard failures</li>
<li>
<strong>Assumption checks</strong> at boundaries (imports, exports, joins) rather than every operation</li>
<li>
<strong>Optional lineage tracking</strong> with stable row IDs</li>
<li>
<strong>Drift detection</strong> to catch changes between data versions</li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu">pak</span><span class="op">(</span><span class="st">"gcol33/keyed"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<div class="section level3">
<h3 id="key-definition">Key Definition<a class="anchor" aria-label="anchor" href="#key-definition"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Single key</span></span>
<span><span class="va">users</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/key.html">key</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">user_id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Composite key</span></span>
<span><span class="va">orders</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/key.html">key</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">customer_id</span>, <span class="va">order_date</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check key status</span></span>
<span><span class="fu"><a href="reference/has_key.html">has_key</a></span><span class="op">(</span><span class="va">users</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/get_key_cols.html">get_key_cols</a></span><span class="op">(</span><span class="va">users</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/key_is_valid.html">key_is_valid</a></span><span class="op">(</span><span class="va">users</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="assumption-checks">Assumption Checks<a class="anchor" aria-label="anchor" href="#assumption-checks"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Uniqueness</span></span>
<span><span class="fu"><a href="reference/assume_unique.html">assume_unique</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">col1</span>, <span class="va">col2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Missing values</span></span>
<span><span class="fu"><a href="reference/assume_no_na.html">assume_no_na</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">required_col</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Completeness (all expected values present)</span></span>
<span><span class="fu"><a href="reference/assume_complete.html">assume_complete</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">category</span>, expected <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Coverage (reference values covered)</span></span>
<span><span class="fu"><a href="reference/assume_coverage.html">assume_coverage</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">id</span>, reference <span class="op">=</span> <span class="va">ref_data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Row count</span></span>
<span><span class="fu"><a href="reference/assume_nrow.html">assume_nrow</a></span><span class="op">(</span><span class="va">data</span>, min <span class="op">=</span> <span class="fl">100</span>, max <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="join-diagnostics">Join Diagnostics<a class="anchor" aria-label="anchor" href="#join-diagnostics"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analyze join before executing</span></span>
<span><span class="fu"><a href="reference/diagnose_join.html">diagnose_join</a></span><span class="op">(</span><span class="va">users</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"user_id"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Join Diagnosis ──</span></span>
<span><span class="co">#&gt; Cardinality: one-to-many</span></span>
<span><span class="co">#&gt; x: 1000 rows, unique</span></span>
<span><span class="co">#&gt; y: 5432 rows, 4432 duplicates</span></span>
<span></span>
<span><span class="co"># For validated joins, use joinspy</span></span>
<span><span class="co"># pak::pak("gcol33/joinspy")</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="row-identity-tracking">Row Identity Tracking<a class="anchor" aria-label="anchor" href="#row-identity-tracking"></a>
</h3>
<p>Opt-in stable UUIDs for lineage tracking:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add IDs to rows</span></span>
<span><span class="va">users</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/add_id.html">add_id</a></span><span class="op">(</span><span class="va">users</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># IDs persist through transformations</span></span>
<span><span class="va">filtered</span> <span class="op">&lt;-</span> <span class="va">users</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">active</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/get_id.html">get_id</a></span><span class="op">(</span><span class="va">filtered</span><span class="op">)</span>  <span class="co"># Same IDs as original rows</span></span>
<span></span>
<span><span class="co"># Combine data with ID handling</span></span>
<span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bind_id.html">bind_id</a></span><span class="op">(</span><span class="va">batch1</span>, <span class="va">batch2</span><span class="op">)</span>  <span class="co"># Checks overlaps, fills missing</span></span>
<span></span>
<span><span class="co"># Create deterministic IDs from columns</span></span>
<span><span class="va">sales</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/make_id.html">make_id</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">country</span>, <span class="va">year</span><span class="op">)</span>  <span class="co"># "US|2024"</span></span>
<span></span>
<span><span class="co"># Validate ID integrity</span></span>
<span><span class="fu"><a href="reference/check_id.html">check_id</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/check_id_disjoint.html">check_id_disjoint</a></span><span class="op">(</span><span class="va">data1</span>, <span class="va">data2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare before/after</span></span>
<span><span class="fu"><a href="reference/compare_ids.html">compare_ids</a></span><span class="op">(</span><span class="va">before</span>, <span class="va">after</span><span class="op">)</span></span>
<span><span class="co">#&gt; $lost: 2 IDs</span></span>
<span><span class="co">#&gt; $gained: 5 IDs</span></span>
<span><span class="co">#&gt; $preserved: 998 IDs</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="drift-detection">Drift Detection<a class="anchor" aria-label="anchor" href="#drift-detection"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Commit a reference snapshot</span></span>
<span><span class="va">users</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/commit_keyed.html">commit_keyed</a></span><span class="op">(</span><span class="va">users</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✓ Snapshot committed: a5ab1a98...</span></span>
<span></span>
<span><span class="co"># Later, check for changes</span></span>
<span><span class="fu"><a href="reference/check_drift.html">check_drift</a></span><span class="op">(</span><span class="va">users</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Drift Report ──</span></span>
<span><span class="co">#&gt; ⚠ Drift detected</span></span>
<span><span class="co">#&gt; ℹ Row count: 1000 -&gt; 1024 (+24)</span></span>
<span><span class="co">#&gt; ℹ Cell values modified</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quick status check</span></span>
<span><span class="fu"><a href="reference/key_status.html">key_status</a></span><span class="op">(</span><span class="va">users</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">users</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare keys between datasets</span></span>
<span><span class="fu"><a href="reference/compare_keys.html">compare_keys</a></span><span class="op">(</span><span class="va">old_data</span>, <span class="va">new_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find duplicates</span></span>
<span><span class="fu"><a href="reference/find_duplicates.html">find_duplicates</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">key_col</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="philosophy">Philosophy<a class="anchor" aria-label="anchor" href="#philosophy"></a>
</h2>
<ul>
<li>
<strong>Keys are explicit</strong>: Define once, validate at creation</li>
<li>
<strong>Warnings over errors</strong>: Alert on violations, don’t block by default</li>
<li>
<strong>Graceful degradation</strong>: Key metadata survives transformations when possible, drops cleanly when not</li>
<li>
<strong>Boundary checks</strong>: Validate at joins and exports, not on every operation</li>
<li>
<strong>No magic</strong>: No hidden state, no sidecar files, no databases</li>
</ul>
</div>
<div class="section level2">
<h2 id="enhanced-diagnostics">Enhanced Diagnostics<a class="anchor" aria-label="anchor" href="#enhanced-diagnostics"></a>
</h2>
<p>Install <a href="https://github.com/gcol33/joinspy" class="external-link">joinspy</a> for richer join diagnostics:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu">pak</span><span class="op">(</span><span class="st">"gcol33/joinspy"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># diagnose_join() automatically uses joinspy when available</span></span>
<span><span class="fu"><a href="reference/diagnose_join.html">diagnose_join</a></span><span class="op">(</span><span class="va">users</span>, <span class="va">orders</span>, by <span class="op">=</span> <span class="st">"user_id"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Pre-Join Diagnostic Report ──</span></span>
<span><span class="co">#&gt; ... detailed whitespace, encoding, and match analysis ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<ul>
<li><a href="https://gcol33.github.io/keyed/articles/getting-started.html">Getting Started</a></li>
<li><a href="https://gcol33.github.io/keyed/reference/index.html">Function Reference</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="support">Support<a class="anchor" aria-label="anchor" href="#support"></a>
</h2>
<p>If this package saved you some time, buying me a coffee is a nice way to say thanks.</p>
<p><a href="https://buymeacoffee.com/gcol33" class="external-link"><img src="https://img.shields.io/badge/-Buy%20me%20a%20coffee-FFDD00?logo=buymeacoffee&amp;logoColor=black" alt="Buy Me A Coffee"></a></p>
</div>
<div class="section level2">
<h2 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h2>
<p>MIT (see the LICENSE.md file)</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/gcol33/keyed/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/gcol33/keyed/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing keyed</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/gcol33" class="external-link">Gilles Colling</a> <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gcol33" class="external-link">Gilles Colling</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
